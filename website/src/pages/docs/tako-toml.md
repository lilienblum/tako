---
layout: ../../layouts/DocsLayout.astro
title: Tako Docs - tako.toml Reference
heading: tako.toml Reference
current: tako-tom
---

# `tako.toml` Reference

`tako.toml` is your project's control panel for app metadata, build/deploy behavior, env vars, routes, and server behavior.

## Minimal Config

This is the minimal starting point generated by `tako init`:

```toml
name = "my-app"

[build]
preset = "bun"

[envs.production]
route = "my-app.example.com"
```

`tako init` prompts for `name` and `[envs.production].route`, then offers built-in adapter presets (`bun`, `node`, `deno`) plus a custom option that leaves `[build].preset` unset. It only writes `main` when adapter inference finds an entrypoint that differs from the selected preset default.

`name` is required. Treat it as a stable identifier and do not change it after first deploy.

## Top-Level App Fields

App-level metadata.

```toml
name = "my-app"
main = "server/index.mjs"

[build]
preset = "bun"
# include = ["dist/**", ".output/**"]
# exclude = ["**/*.map"]
# assets = ["dist/client", "assets/shared"]
```

- `name`: required stable app identifier used in deploy paths and local dev hostnames. Set once and do not change after first deploy.
- `main`: optional runtime entry override written to deployed `app.json` and used by `tako dev`/`tako deploy`.
  - If omitted, Tako uses preset top-level `main` when present.
  - If neither `tako.toml main` nor preset `main` is set, deploy/dev fail.
  - During deploy artifact prep, Tako verifies this resolved path exists in the post-build app directory and fails if it is missing.
- `[build]`: deploy artifact build config.
  - `preset`: optional build preset override. If omitted, deploy/dev use detected adapter base preset (`bun`, `node`, or `deno`). Supports:
    - official aliases: `bun`, `node`, `deno`, `bun/tanstack-start`
    - pinned aliases: `bun/<commit-hash>` (legacy), `bun@<commit-hash>`, `bun/tanstack-start@<commit-hash>`
    - GitHub refs: `github:<owner>/<repo>/<path>.toml[@<commit-hash>]`
  - `include`: optional artifact include globs (`**/*` is used when unset).
  - `exclude`: optional artifact exclude globs (appended to preset excludes).
  - `assets`: optional project-relative directories merged into app `public/` after build (later entries overwrite earlier files on conflicts).
  - Built-in presets are organized under `presets/<adapter>/<name>.toml` (for example `presets/bun/bun.toml`, `presets/bun/tanstack-start.toml`).
  - Build preset files support optional top-level `name`, top-level `main` (default app entrypoint), top-level `dev`, top-level `install`/`start`, top-level `assets`, and preset `[build]` keys (`exclude`, `install`, `build`, optional `targets = ["linux-<arch>-<libc>", ...]`, optional `container` with deprecated alias `docker`); legacy preset `[dev]`, `[deploy]`, preset `include`, and `[artifact]` are not supported. Deprecated top-level `dev_cmd` is still accepted as an alias.
  - `bun/tanstack-start` (legacy alias `bun-tanstack-start`) defaults `main = "dist/server/tako-entry.mjs"` and `assets = ["dist/client"]`.
  - Deploy writes lock metadata to `.tako/build.lock.json` so the resolved preset commit stays reproducible across deploys.
  - Deploy build mode is controlled by preset `[build].container` (or deprecated `[build].docker`).
    - `true`: Docker target builds
    - `false`: local host target builds
    - unset: defaults to Docker only when `[build].targets` is non-empty
  - Docker builds reuse target-scoped dependency cache volumes (proto + runtime cache mounts) while keeping build containers ephemeral.
  - Runtime version is resolved via `proto run <tool> -- --version` when available, then falls back to `.prototools`, then `latest`.
  - Deploy artifact cache keys include resolved preset source/commit, runtime tool/version, build mode (Docker/local), and `build.include` / `build.exclude` / `build.assets`; changing these inputs invalidates cache and triggers rebuild for affected targets.
  - Bun runtime dependencies are installed on server from the uploaded release (`bun install --production`).
  - On every deploy, Tako prunes local `.tako/artifacts/` cache (best-effort): keeps 30 newest source archives, keeps 90 newest target artifacts, and removes orphan target metadata files.
- Legacy top-level `build = "..."` and top-level `assets = [...]` are not supported.

## `[vars]`

Global environment variables applied to every environment.

```toml
[vars]
LOG_LEVEL = "info"
API_BASE_URL = "https://api.example.com"
```

## `[vars.<environment>]`

Per-environment overrides merged on top of `[vars]`.

```toml
[vars.production]
LOG_LEVEL = "warn"

[vars.staging]
LOG_LEVEL = "debug"
API_BASE_URL = "https://staging-api.example.com"
```

## `[envs.<environment>]`

Environment route declarations and optional environment-local variables.

```toml
[envs.production]
route = "api.example.com"
# routes = ["api.example.com", "www.api.example.com"]
# route = "example.com/api/*"
# routes = ["example.com/api/*", "example.com/admin/*"]
LOG_FORMAT = "json"
```

- `route`: single hostname/path pattern.
- `routes`: multiple route patterns (use this instead of `route` when you have more than one).
- Each environment can set `route` or `routes`, but not both.
- Every non-development environment must define `route` or `routes`.
- `[envs.development]` may omit routes and defaults to `{app}.tako.local` for `tako dev`.
- Development routes must be `{app}.tako.local` or a subdomain of it.
- Empty route sets are rejected for non-development environments. There is no implicit catch-all routing mode.
- Additional keys in an environment section are treated as environment variables.
- Routes must include a hostname (path-only routes are invalid).
- `example.com` and `example.com/*` are equivalent and both match all paths on `example.com`.
- Public route hostnames use ACME certificates; private/local hostnames (`localhost`, `*.localhost`, single-label hosts, and reserved suffixes like `*.local`) use self-signed certs generated during deploy.
- Path route examples:
  - `example.com/api/*` matches `/api`, `/api/`, and `/api/...`
  - `example.com/admin/*` matches `/admin`, `/admin/`, and `/admin/...`

## `[servers]`

Default runtime settings applied to every mapped server unless overridden.

```toml
[servers]
instances = 0
port = 80
idle_timeout = 300
```

- `instances = 0` means on-demand instances. Deploy keeps one warm instance running; idle timeout can scale it to zero. Once at zero, first request waits for cold start readiness up to startup timeout (30s default), then returns `504 App startup timed out` if still not ready. If startup fails before readiness, it returns `502 App failed to start`.
- `port` is the app upstream port.
- `idle_timeout` is in seconds.

## `[servers.<name>]`

Per-server overrides. The section name must match a server added with `tako servers add`.

```toml
[servers.production]
env = "production"
instances = 2
port = 8080
idle_timeout = 300
```

- `env` is required.
- `instances`, `port`, and `idle_timeout` are optional overrides.
- `arch`/`libc` are not configured in `tako.toml`; Tako detects and stores them in global server config (`~/.tako/config.toml`) when adding servers.

## Variable Merge Order

For a target environment, variables are merged in this order:

1. `[vars]`
2. `[vars.<environment>]`
3. Auto-set by Tako during deploy (`TAKO_ENV=<environment>`, `TAKO_BUILD=<version>`, plus runtime vars like `NODE_ENV` / `BUN_ENV`)

Later values override earlier ones when keys match.

## Complete Example

```toml
name = "my-app"
main = "server/index.mjs"

[build]
preset = "bun"
assets = ["assets/shared"]

[vars]
LOG_LEVEL = "info"

[vars.production]
LOG_LEVEL = "warn"

[envs.production]
routes = ["api.example.com", "www.api.example.com"]
LOG_FORMAT = "json"

[envs.staging]
route = "staging.example.com"
LOG_LEVEL = "debug"

[servers]
instances = 0
port = 80
idle_timeout = 300

[servers.primary]
env = "production"
instances = 2
```
