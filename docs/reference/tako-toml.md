# `tako.toml` Reference

`tako.toml` configures app metadata, environment variables, routes, and server behavior for a project.

## Minimal Config

This is the minimal starting point generated by `tako init`:

```toml
[envs.production]
route = "my-app.example.com"
```

By default, app name stays adapter/runtime-derived unless you explicitly set `[tako].name`.

## `[tako]`

App-level metadata.

```toml
[tako]
name = "my-app"
build = "bun run build"
```

- `name`: app identifier used in deploy paths and local dev hostnames.
- `build`: optional build command run before deploy.

## `[vars]`

Global environment variables applied to every environment.

```toml
[vars]
LOG_LEVEL = "info"
API_BASE_URL = "https://api.example.com"
```

## `[vars.<environment>]`

Per-environment variable overrides merged on top of `[vars]`.

```toml
[vars.production]
LOG_LEVEL = "warn"

[vars.staging]
LOG_LEVEL = "debug"
API_BASE_URL = "https://staging-api.example.com"
```

## `[envs.<environment>]`

Environment route declarations and optional env-local variables.

```toml
[envs.production]
route = "api.example.com"
# routes = ["api.example.com", "*.api.example.com"]
# route = "example.com/api/*"
# routes = ["example.com/api/*", "example.com/admin/*"]
LOG_FORMAT = "json"
```

- `route`: single hostname/path pattern.
- `routes`: multiple route patterns. Use this instead of `route`.
- Additional keys in an environment section are treated as environment variables.
- `example.com` and `example.com/*` are equivalent and both match all paths on `example.com`.
- Path route examples:
  - `example.com/api/*` matches `/api`, `/api/`, and `/api/...`
  - `example.com/admin/*` matches `/admin`, `/admin/`, and `/admin/...`

## `[servers]`

Default runtime settings applied to every mapped server unless overridden.

```toml
[servers]
instances = 0
port = 80
idle_timeout = 300
```

- `instances = 0` means on-demand instances.
- `port` is the app upstream port.
- `idle_timeout` is in seconds.

## `[servers.<name>]`

Per-server overrides. The section name must match a server added with `tako servers add`.

```toml
[servers.production]
env = "production"
instances = 2
port = 8080
idle_timeout = 300
```

- `env` is required.
- `instances`, `port`, and `idle_timeout` are optional overrides.

## Variable Merge Order

For a target environment, variables are merged in this order:

1. `[vars]`
2. `[vars.<environment>]`
3. inline variables from `[envs.<environment>]`

Later values override earlier ones when keys match.

## Complete Example

```toml
[tako]
name = "my-app"
build = "bun run build"

[vars]
LOG_LEVEL = "info"

[vars.production]
LOG_LEVEL = "warn"

[envs.production]
routes = ["api.example.com", "*.api.example.com"]
LOG_FORMAT = "json"

[envs.staging]
route = "staging.example.com"
LOG_LEVEL = "debug"

[servers]
instances = 0
port = 80
idle_timeout = 300

[servers.primary]
env = "production"
instances = 2
```
